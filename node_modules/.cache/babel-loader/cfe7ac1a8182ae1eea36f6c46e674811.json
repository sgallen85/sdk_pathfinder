{"ast":null,"code":"import _slicedToArray from\"/Users/sallen/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _createForOfIteratorHelper from\"/Users/sallen/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper\";import _classCallCheck from\"/Users/sallen/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/sallen/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/Users/sallen/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/sallen/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import{Component}from'react';import'./Menu.scss';import Accordion from'../reusables/accordion/Accordion';import AccordionGroup from'../reusables/accordion/AccordionGroup';import AccordionItem from'../reusables/accordion/AccordionItem';import Icon from'../reusables/icon/Icon';import MenuNudge from'./MenuNudge';import{LanguageOptions,loc}from'../Localization';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";/**\n * Time (ms) until nudge displays\n */var MENU_NUDGE_TIMEOUT=2000;/**\n * Key name for browser storage of whether nudge has been seen (close button clicked)\n */var MENU_NUDGE_SEEN_KEY='menu_nudge_seen';/**\n * Component for UI elements like sweep selector, location info, etc.\n */var Menu=/*#__PURE__*/function(_Component){_inherits(Menu,_Component);var _super=_createSuper(Menu);function Menu(props){var _this;_classCallCheck(this,Menu);_this=_super.call(this,props);_this.onCloseNudge=function(){sessionStorage.setItem(MENU_NUDGE_SEEN_KEY,'true');_this.setState({displayNudge:false});};_this.state={sweepGroups:{},displayNudge:false};return _this;}_createClass(Menu,[{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;var nudgeSeen=sessionStorage.getItem(MENU_NUDGE_SEEN_KEY);if(!nudgeSeen||nudgeSeen==='false'){window.setTimeout(function(){_this2.setState({displayNudge:true});},MENU_NUDGE_TIMEOUT);}}},{key:\"getGroups\",value:function getGroups(){var _this$props=this.props,sweepData=_this$props.sweepData,sweepAlias=_this$props.sweepAlias;var groups={};var _iterator=_createForOfIteratorHelper(sweepData),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var s=_step.value;if(sweepAlias&&!(s.sid in sweepAlias))continue;// skip sweeps without alias, if available\nvar floor=''+s.floor;if(!(floor in groups)){groups[floor]=[];}groups[floor].push(s);}}catch(err){_iterator.e(err);}finally{_iterator.f();}return groups;}},{key:\"renderItem\",value:function renderItem(s){var _this$props2=this.props,lang=_this$props2.lang,onChange=_this$props2.onChange,selectedSweepId=_this$props2.selectedSweepId,sweepAlias=_this$props2.sweepAlias;var sid=s.sid;var name=sweepAlias?loc(sweepAlias[sid],lang):sid;// replace sid with alias, if available\nreturn/*#__PURE__*/_jsx(AccordionItem,{header:name,onClick:function onClick(){return onChange(sid);},selected:sid===selectedSweepId},sid);}/**\n   * Renders sweeps grouped by floors.\n   * @returns List of `<AccordionGroup>` with items inside.\n   */},{key:\"renderGroups\",value:function renderGroups(){var _this$props3=this.props,lang=_this$props3.lang,selectedSweepId=_this$props3.selectedSweepId,floorMap=_this$props3.floorMap;var sweepGroups=this.getGroups();var floors=[];var selectedFloor=undefined;for(var _i=0,_Object$entries=Object.entries(sweepGroups);_i<_Object$entries.length;_i++){var _floorMap$floor,_floorMap$floor2;var _Object$entries$_i=_slicedToArray(_Object$entries[_i],2),floor=_Object$entries$_i[0],sweeps=_Object$entries$_i[1];if(!(floor in floors))floors[floor]=[];var items=[];var _iterator2=_createForOfIteratorHelper(sweeps),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var s=_step2.value;items.push(this.renderItem(s));if(s.sid===selectedSweepId){selectedFloor=s.floor;}}}catch(err){_iterator2.e(err);}finally{_iterator2.f();}var floorName=floorMap===null||floorMap===void 0?void 0:(_floorMap$floor=floorMap[floor])===null||_floorMap$floor===void 0?void 0:_floorMap$floor.name;var floorSequence=floorMap===null||floorMap===void 0?void 0:(_floorMap$floor2=floorMap[floor])===null||_floorMap$floor2===void 0?void 0:_floorMap$floor2.sequence;// use floor name, 1-indexed sequence, id in that order of priority\nvar header=floorName||floorSequence!==undefined&&\"\".concat(loc('Floor',lang),\" \").concat(floorSequence+1)||floor;floors.push(/*#__PURE__*/_jsx(AccordionGroup,{header:header,expanded:!!selectedFloor&&''+selectedFloor===floor,showNumber:true,children:items},floor));}return floors;}},{key:\"renderLanguageSelect\",value:function renderLanguageSelect(){var langOptions=[];for(var _i2=0,_Object$values=Object.values(LanguageOptions);_i2<_Object$values.length;_i2++){var _Object$values$_i=_Object$values[_i2],code=_Object$values$_i.code,text=_Object$values$_i.text;langOptions.push(/*#__PURE__*/_jsx(\"option\",{value:code,children:text}));}return/*#__PURE__*/_jsx(\"div\",{style:{marginLeft:'auto'},children:/*#__PURE__*/_jsx(\"select\",{className:\"language-select\",onChange:this.props.onChangeLang,children:langOptions})});}},{key:\"render\",value:function render(){var _this$props4=this.props,lang=_this$props4.lang,onClose=_this$props4.onClose;var displayNudge=this.state.displayNudge;return/*#__PURE__*/_jsxs(\"div\",{className:\"menu\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"menu-header\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"menu-header-text header-font\",children:loc('Locations',lang)}),this.renderLanguageSelect(),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"menu-close-button\",onClick:onClose,children:/*#__PURE__*/_jsx(Icon,{icon:\"close\"})})]}),/*#__PURE__*/_jsx(Accordion,{children:this.renderGroups()}),displayNudge&&/*#__PURE__*/_jsx(MenuNudge,{text:loc('nudge_text',lang),closeText:loc('CLOSE',lang),onClose:this.onCloseNudge})]});}}]);return Menu;}(Component);export{Menu as default};","map":{"version":3,"sources":["/Users/sallen/Documents/GitHub/sdk_wayfinder/src/app/ui/Menu.tsx"],"names":["Component","Accordion","AccordionGroup","AccordionItem","Icon","MenuNudge","LanguageOptions","loc","MENU_NUDGE_TIMEOUT","MENU_NUDGE_SEEN_KEY","Menu","props","onCloseNudge","sessionStorage","setItem","setState","displayNudge","state","sweepGroups","nudgeSeen","getItem","window","setTimeout","sweepData","sweepAlias","groups","s","sid","floor","push","lang","onChange","selectedSweepId","name","floorMap","getGroups","floors","selectedFloor","undefined","Object","entries","sweeps","items","renderItem","floorName","floorSequence","sequence","header","langOptions","values","code","text","marginLeft","onChangeLang","onClose","renderLanguageSelect","renderGroups"],"mappings":"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","sourcesContent":["import { Component } from 'react';\nimport { Dictionary, MpSdk, Sweep } from '../../mp/sdk';\nimport './Menu.scss';\nimport Accordion from '../reusables/accordion/Accordion';\nimport AccordionGroup from '../reusables/accordion/AccordionGroup';\nimport AccordionItem from '../reusables/accordion/AccordionItem';\nimport { SweepAlias } from '../sweepAliases';\nimport Icon from '../reusables/icon/Icon';\nimport MenuNudge from './MenuNudge';\nimport { LanguageOptions, loc } from '../Localization';\n\ninterface MenuProps {\n  lang: string;\n  currSweepId?: string;\n  selectedSweepId?: string;\n  sweepData: Sweep.SweepData[];\n  sweepAlias?: SweepAlias;\n  floorMap?: Dictionary<MpSdk.Floor.FloorData>;\n  onChange: (e: any) => void;\n  onClose: () => void;\n  onChangeLang: (e: any) => void;\n}\n\ninterface MenuState {\n  sweepGroups: SweepGroups;\n  displayNudge: boolean;\n}\n\ninterface SweepGroups {\n  [group: string]: Sweep.SweepData[];\n}\n\n/**\n * Time (ms) until nudge displays\n */\nconst MENU_NUDGE_TIMEOUT = 2000;\n/**\n * Key name for browser storage of whether nudge has been seen (close button clicked)\n */\nconst MENU_NUDGE_SEEN_KEY = 'menu_nudge_seen';\n\n/**\n * Component for UI elements like sweep selector, location info, etc.\n */\nexport default class Menu extends Component<MenuProps, MenuState> {\n\n  constructor(props: any) {\n    super(props);\n    this.state = {\n      sweepGroups: {},\n      displayNudge: false,\n    };    \n  }\n\n  public componentDidMount() {\n    const nudgeSeen = sessionStorage.getItem(MENU_NUDGE_SEEN_KEY);\n    if (!nudgeSeen || nudgeSeen === 'false') {\n      window.setTimeout(() => {\n        this.setState({\n          displayNudge: true,\n        });\n      }, MENU_NUDGE_TIMEOUT);\n    }\n  }\n\n  private onCloseNudge = () => {\n    sessionStorage.setItem(MENU_NUDGE_SEEN_KEY, 'true');\n    this.setState({\n      displayNudge: false,\n    });\n  }\n\n  private getGroups() {\n    const { sweepData, sweepAlias } = this.props;\n    const groups: SweepGroups = {};\n    for (const s of sweepData) {\n      if (sweepAlias && !(s.sid in sweepAlias)) continue; // skip sweeps without alias, if available\n      const floor = '' + s.floor;\n      if (!(floor in groups)) {\n        groups[floor] = [];\n      }\n      groups[floor].push(s);\n    }\n    return groups;\n  }\n\n  private renderItem(s: Sweep.SweepData) {\n    const { lang, onChange, selectedSweepId, sweepAlias } = this.props;\n    const { sid } = s;\n    const name = sweepAlias ? loc(sweepAlias[sid], lang) : sid; // replace sid with alias, if available\n    return (\n      <AccordionItem\n        header={name}\n        onClick={() => onChange(sid)}\n        selected={sid === selectedSweepId}\n        key={sid}\n      />\n    );\n  }\n\n  /**\n   * Renders sweeps grouped by floors.\n   * @returns List of `<AccordionGroup>` with items inside.\n   */\n  private renderGroups() {\n    const { lang, selectedSweepId, floorMap } = this.props;\n    const sweepGroups = this.getGroups();\n    const floors: any = [];\n    let selectedFloor = undefined;\n\n    for (const [floor, sweeps] of Object.entries(sweepGroups)) {\n      if (!(floor in floors)) floors[floor] = [];\n      \n      const items = []\n      for (const s of sweeps) {\n        items.push(this.renderItem(s));\n        if (s.sid === selectedSweepId) {\n          selectedFloor = s.floor;\n        }\n      }\n\n      const floorName = floorMap?.[floor]?.name;\n      const floorSequence = floorMap?.[floor]?.sequence;\n\n      // use floor name, 1-indexed sequence, id in that order of priority\n      const header = floorName ||\n        (floorSequence !== undefined && `${loc('Floor', lang)} ${floorSequence+1}`) ||\n        floor;\n\n      floors.push(\n        <AccordionGroup\n          header={header}\n          expanded={!!selectedFloor && ''+selectedFloor === floor}\n          showNumber={true}\n          key={floor}\n        >\n          {items}\n        </AccordionGroup>\n      );\n    }\n    return floors;\n  }\n\n  public renderLanguageSelect() {\n    const langOptions = [];\n    for (const {code, text} of Object.values(LanguageOptions)) {\n      langOptions.push(<option value={code}>{text}</option>);\n    }\n    return (\n      <div style={{ marginLeft: 'auto' }}>\n        <select\n          className='language-select'\n          onChange={this.props.onChangeLang}\n        >\n          {langOptions}\n        </select>\n      </div>\n    );\n  }\n  \n  public render() {\n    const { lang, onClose } = this.props;\n    const { displayNudge } = this.state;\n    return (\n      <div className='menu'>\n        <div className='menu-header'>\n          <div className='menu-header-text header-font'>{loc('Locations', lang)}</div>\n          {this.renderLanguageSelect()}\n          <button type='button' className='menu-close-button' onClick={onClose}>\n            <Icon icon='close' />\n          </button>\n        </div>\n        <Accordion>\n          {this.renderGroups()}\n        </Accordion>\n        { displayNudge &&\n          <MenuNudge\n            text={loc('nudge_text', lang)}\n            closeText={loc('CLOSE', lang)}\n            onClose={this.onCloseNudge}\n          />\n        }\n      </div>\n    );\n  }\n}"]},"metadata":{},"sourceType":"module"}